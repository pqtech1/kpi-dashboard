<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Jewel INTEGRA</title>

    <meta
      name="description"
      content="Jewel INTEGRA is an ERP-agnostic integration platform and plant KPI dashboard for jewellery manufacturing, enabling real-time insights, automation, and system connectivity."
    />

    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <meta name="author" content="Jewel INTEGRA" />

    <!-- Open Graph -->
    <meta property="og:title" content="Jewel INTEGRA" />
    <meta
      property="og:description"
      content="ERP-agnostic integration platform with real-time plant KPI dashboards for jewellery manufacturing."
    />
    <meta property="og:type" content="website" />
    <!-- Replace with your own image -->
    <meta property="og:image" content="/og-image.png" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Jewel INTEGRA" />
    <meta
      name="twitter:description"
      content="ERP-agnostic integration & real-time KPI dashboards for jewellery plants."
    />
    <meta name="twitter:image" content="/og-image.png" />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <!-- Email Campaign Tracking Script -->
    <script>
      // tracking.js
      class EmailTracker {
        constructor() {
          this.sessionId = this.generateSessionId();
          this.startTime = Date.now();
          this.maxScroll = 0;
          this.init();
        }

        generateSessionId() {
          return (
            "session_" +
            Date.now() +
            "_" +
            Math.random().toString(36).substr(2, 9)
          );
        }

        init() {
          // Get tracking params from URL
          this.params = this.getTrackingParams();

          if (
            this.params.campaign_id &&
            this.params.lead_id &&
            this.params.email
          ) {
            this.trackPageView();
            this.setupEventListeners();
          }
        }

        getTrackingParams() {
          const params = new URLSearchParams(window.location.search);
          return {
            campaign_id: params.get("campaign_id"),
            lead_id: params.get("lead_id"),
            email: params.get("email"),
            source: params.get("source") || "direct",
            link_type: params.get("link_type"),
          };
        }

        trackPageView() {
          const data = {
            ...this.params,
            page_url: window.location.href,
            page_title: document.title,
            referrer: document.referrer,
            time_spent: 0,
            scroll_depth: 0,
          };

          // Send initial page view
          this.sendTracking("/track/page-view", data);

          // Track scroll
          window.addEventListener("scroll", () => {
            const scrollPercent = Math.round(
              (window.scrollY /
                (document.documentElement.scrollHeight - window.innerHeight)) *
                100
            );
            this.maxScroll = Math.max(this.maxScroll, scrollPercent);
          });

          // Send final data before unload
          window.addEventListener("beforeunload", () => {
            data.time_spent = Math.floor((Date.now() - this.startTime) / 1000);
            data.scroll_depth = this.maxScroll;
            this.sendTracking("/track/page-view", data, true);
          });
        }

        setupEventListeners() {
          // Track link clicks
          document.addEventListener("click", (e) => {
            const link = e.target.closest("a");
            if (!link || !link.href || link.href.startsWith("javascript:"))
              return;

            const data = {
              ...this.params,
              link_url: link.href,
              link_text: link.textContent?.trim().substring(0, 200) || "",
              page_url: window.location.href,
              link_type: this.determineLinkType(link),
            };

            this.sendTracking("/track/internal-click", data, true);
          });
        }

        determineLinkType(link) {
          const href = link.href.toLowerCase();
          const text = link.textContent?.toLowerCase() || "";

          if (href.includes("/production")) return "production";
          if (href.includes("/material-cost")) return "material_cost";
          if (href.includes("/design-cad")) return "design_cad";
          if (href.includes("/casting")) return "casting";
          if (href.includes("/finishing")) return "finishing";
          if (href.includes("/quality-control")) return "quality_control";
          if (href.includes("/executive")) return "executive";
          if (href.includes("/pq-offering")) return "services";

          return "other";
        }

        sendTracking(endpoint, data, useBeacon = false) {
          const url = endpoint;

          if (useBeacon && navigator.sendBeacon) {
            const formData = new FormData();
            Object.keys(data).forEach((key) => {
              formData.append(key, data[key]);
            });
            navigator.sendBeacon(url, formData);
          } else {
            fetch(url, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Accept: "application/json",
              },
              body: JSON.stringify(data),
              keepalive: true,
            }).catch(console.error);
          }
        }
      }

      // Initialize when DOM is ready
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", () => new EmailTracker());
      } else {
        new EmailTracker();
      }
    </script>
  </body>
</html>
